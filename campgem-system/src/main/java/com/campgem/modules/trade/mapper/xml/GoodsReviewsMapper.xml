<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.campgem.modules.trade.mapper.GoodsReviewsMapper">
	
	<select id="queryPageList" resultType="com.campgem.modules.trade.vo.GoodsReviewsVo">
		SELECT gr.id,
		       gr.uid,
		       ub.src_face,
		       ub.nick_name,
		       if(m.member_type = 'BUSINESS', 1, 2) as identity,
		       gr.content,
		       gr.create_time
		FROM goods_reviews gr
			     left join user_base as ub on ub.id = gr.uid
			     left join member m on m.user_base_id = ub.id
		WHERE gr.goods_id = #{goodsId}
		  and gr.del_flag = 0
		  <if test="shields.size gt 0">
			  and gr.uid not in
			  <foreach item="item" index="index" collection="shields"
			           open="(" separator="," close=")">
				  #{item}
			  </foreach>
		  </if>
		limit #{start}, #{pageSize}
	</select>
</mapper>